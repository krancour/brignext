id: brignext-demo
description: A project that demonstrates brignext
events:
- source: brignext-cli
  types:
  - exec
  labels:
    foo: bar
    bat: baz
workerConfig:
  container:
    environment:
      FOO: bar
  workspaceSize: 10Gi
  defaultConfigFiles:
    brigade.js: |-
      const { events, Job, Group} = require("brigadier");

      events.on("brignext-cli:exec", (e, w) => {
        let fooJob = new Job("foo", "debian:latest", ["echo $FOO"]);
        fooJob.env = {
          "FOO": w.secrets.foo
        };
        
        let barJob = new Job("bar", "debian:latest", ["echo $BAR"]);
        barJob.env = {
          "BAR": w.secrets.bar
        };

        fooJob.run()
        .then(result => {
          return barJob.run();
        })
        .then(result => {
          console.log("done");
        }).catch(e => {
          console.error(e);
        });
      });
  jobsConfig:
    allowPrivileged: true
    allowDockerSocketMount: true
